{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yannihome/Documents/School/HackerU/Projects/HackeruProject-react-YanivZinger/hackeru-react-shop/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/yannihome/Documents/School/HackerU/Projects/HackeruProject-react-YanivZinger/hackeru-react-shop/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from\"axios\";import{jwtDecode}from\"jwt-decode\";import{useDispatch}from\"react-redux\";import{authActions}from\"../store/authSlice\";import{getToken}from\"../service/storageService\";var useAutoLogin=function useAutoLogin(){var dispatch=useDispatch();return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var skipTokenTest,token,dataFromToken,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:skipTokenTest=_args.length>0&&_args[0]!==undefined?_args[0]:false;_context.prev=1;token=getToken();console.log(\"token!!\",token);if(token){_context.next=6;break;}return _context.abrupt(\"return\");case 6:dataFromToken=jwtDecode(token);if(!skipTokenTest){_context.next=10;break;}_context.next=10;return axios.get(\"/users/\".concat(dataFromToken._id));case 10:dispatch(authActions.login(dataFromToken));_context.next=17;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](1);console.log(\"err from auto login\",_context.t0);localStorage.clear();case 17:case\"end\":return _context.stop();}},_callee,null,[[1,13]]);}));};export default useAutoLogin;","map":{"version":3,"names":["axios","jwtDecode","useDispatch","authActions","getToken","useAutoLogin","dispatch","_asyncToGenerator","_regeneratorRuntime","mark","_callee","skipTokenTest","token","dataFromToken","_args","arguments","wrap","_callee$","_context","prev","next","length","undefined","console","log","abrupt","get","concat","_id","login","t0","localStorage","clear","stop"],"sources":["/Users/yannihome/Documents/School/HackerU/Projects/HackeruProject-react-YanivZinger/hackeru-react-shop/src/hooks/useAutoLogin.jsx"],"sourcesContent":["import axios from \"axios\";\nimport { jwtDecode } from \"jwt-decode\";\nimport { useDispatch } from \"react-redux\";\nimport { authActions } from \"../store/authSlice\";\nimport { getToken } from \"../service/storageService\";\n\nconst useAutoLogin = () => {\n  const dispatch = useDispatch();\n  return async (skipTokenTest = false) => {\n    try {\n      const token = getToken();\n      console.log(\"token!!\", token);\n      if (!token) return;\n      const dataFromToken = jwtDecode(token);\n      if (skipTokenTest) await axios.get(`/users/${dataFromToken._id}`);\n      dispatch(authActions.login(dataFromToken));\n    } catch (err) {\n      console.log(\"err from auto login\", err);\n      localStorage.clear();\n    }\n  };\n};\n\nexport default useAutoLogin;\n"],"mappings":"wYAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAASC,SAAS,KAAQ,YAAY,CACtC,OAASC,WAAW,KAAQ,aAAa,CACzC,OAASC,WAAW,KAAQ,oBAAoB,CAChD,OAASC,QAAQ,KAAQ,2BAA2B,CAEpD,GAAM,CAAAC,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAA,CAAS,CACzB,GAAM,CAAAC,QAAQ,CAAGJ,WAAW,CAAC,CAAC,CAC9B,mBAAAK,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAO,SAAAC,QAAA,MAAAC,aAAA,CAAAC,KAAA,CAAAC,aAAA,CAAAC,KAAA,CAAAC,SAAA,QAAAP,mBAAA,GAAAQ,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAOT,aAAa,CAAAG,KAAA,CAAAO,MAAA,IAAAP,KAAA,MAAAQ,SAAA,CAAAR,KAAA,IAAG,KAAK,CAAAI,QAAA,CAAAC,IAAA,GAEzBP,KAAK,CAAGR,QAAQ,CAAC,CAAC,CACxBmB,OAAO,CAACC,GAAG,CAAC,SAAS,CAAEZ,KAAK,CAAC,CAAC,GACzBA,KAAK,EAAAM,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAO,MAAA,kBACJZ,aAAa,CAAGZ,SAAS,CAACW,KAAK,CAAC,KAClCD,aAAa,EAAAO,QAAA,CAAAE,IAAA,WAAAF,QAAA,CAAAE,IAAA,UAAQ,CAAApB,KAAK,CAAC0B,GAAG,WAAAC,MAAA,CAAWd,aAAa,CAACe,GAAG,CAAE,CAAC,SACjEtB,QAAQ,CAACH,WAAW,CAAC0B,KAAK,CAAChB,aAAa,CAAC,CAAC,CAACK,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAC,IAAA,IAAAD,QAAA,CAAAY,EAAA,CAAAZ,QAAA,aAE3CK,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAAN,QAAA,CAAAY,EAAK,CAAC,CACvCC,YAAY,CAACC,KAAK,CAAC,CAAC,CAAC,yBAAAd,QAAA,CAAAe,IAAA,MAAAvB,OAAA,iBAExB,GACH,CAAC,CAED,cAAe,CAAAL,YAAY"},"metadata":{},"sourceType":"module","externalDependencies":[]}